---
title: "Flycode Lable-Free-Quantification based analysis"
author:
- name: Pascal Egloff
  affiliation: Institute of Medical Microbiology, University of Zurich
- name: Christian Panse
  affiliation: Functional Genomics Center Zurich, UZH|ETHZ
  email: cp@fgcz.ethz.ch
- name: Markus Seeger, 
  affiliation: Institute of Medical Microbiology, University of Zurich
date: '2018-09-18, 2018-09-22, 2018-09-27, 2018-09-28, 2018-10-02'
output:
  BiocStyle::html_document
abstract: |
  Description of your vignette
vignette: |
  %\VignetteIndexEntry{5. FlyCode Lable-Free-Quantification based analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Getting started

```{r echo=FALSE}
library(lattice)


cv <- 1 - 1:7 / 10
t <- trellis.par.get("strip.background")
t$col <- (rgb(cv,cv,cv))
trellis.par.set("strip.background",t)
```

```{r}
n.simulation <- 1000
filename <- system.file("extdata/PGexport2_normalizedAgainstSBstandards_Peptides.csv",
                        package = "NestLink")
P <- read.csv(filename,
              header = TRUE, sep=';')
dim(P)
```

## Clean 


remove modificatio
```{r}
P <- P[P$Modifications == '', ]
dim(P)
```

select rows
```{r}
P <- P[,c('Accession', 'Sequence', "X20170919_05_62465_nl5idx1.3_6titratecoli", "X20170919_16_62465_nl5idx1.3_6titratecoli",  "X20170919_09_62466_nl5idx1.3_7titratesmeg", "X20170919_14_62466_nl5idx1.3_7titratesmeg")]
dim(P)
```

rename column names

```{r}
names(P)<-c('Accession','Sequence','coli1', 'coli2', 'smeg1', 'smeg2')
dim(P)
```


remove all rows with invalid identidfier

```{r}

P<- P[grep("^P[0-9][A-Z][0-9]", P$Accession), ] 

P<-droplevels(P)
```


add flycode set annotation
```{r}
P$ConcGr <- NA

P$ConcGr[P$Accession %in% c('P1A4', 'P1B4', 'P1C4', 'P1D4', 'P1E4', 'P1F4')] <- 92

P$ConcGr[P$Accession %in% c('P1A5', 'P1B5', 'P1C5', 'P1D5', 'P1G4', 'P1H4')] <- 295

P$ConcGr[P$Accession %in% c('P1A6', 'P1B6', 'P1E5', 'P1F5', 'P1G5', 'P1H5')] <- 943

P$ConcGr[P$Accession %in% c('P1C6', 'P1D6', 'P1E6', 'P1F6', 'P1G6', 'P1H6')] <- 3017

```

## Sanity check

```{r}
table(P$ConcGr)

Pabs <- P
```

```{r}
table(P$Accession)
```

```{r echo=FALSE}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
```


```{r fig.retina=3}
rv <-lapply(unique(P$ConcGr), function(q){
pairs((P[P$ConcGr == q ,c('coli1', 'coli2', 'smeg1', 'smeg2')]),
      pch=16, col=rgb(0.5,0.5,0.5,alpha = 0.3),
      lower.panel = panel.cor,
      asp=1,
      main=q)
})
```

## Define `FCfill2max`

to complete `data.frame` for random experiment
```{r}
FCfill2max <- function(P, n = max(table(P$Accession))){
   for (i in unique(P$Accession)){
     idx <- which(P$Accession == i)
     # determine the number of missing rows for Accession i
     ndiff <- n - length(idx)
     
     if(length(idx) < n){
       cand <- P[idx[1], ]  
       cand[,2 ] <- "xxx"
       cand[,3:6 ] <- 0
       
       for (j in 1:ndiff){
         P <- rbind(P, cand)
       }
     }
   }
  P
}
```

## Plot compute CVs for each row

```{r}
P.mean <- apply(P[, c('coli1', 'coli2', 'smeg1', 'smeg2')],1, FUN=mean)
P.sd <- apply(P[, c('coli1', 'coli2', 'smeg1', 'smeg2')],1, FUN=sd)

boxplot(100*P.sd/P.mean ~ P$ConcGr,log='y', ylab='CV%')
```


```{r}

```


```{r}
P <- FCfill2max(P)
```

# Absolute Quantification

## Define `FCstatistic` using `coli1` column
```{r}
FCstatistic <- function(P){
  PP <- aggregate(P$coli1 ~ P$Accession + P$ConcGr, FUN=sum)
  
  names(PP) <- c('Accession', 'ConcGr', 'coli1_sum')
  PPP <- aggregate(PP$coli1_sum ~ PP$ConcGr, FUN=mean)

  P.mean <- aggregate(PP$coli1_sum ~ PP$ConcGr, FUN=mean)
  P.sd <- aggregate(PP$coli1_sum ~ PP$ConcGr, FUN=sd)
  P.cv <- aggregate(PP$coli1_sum ~ PP$ConcGr, FUN=function(x){100*sd(x)/mean(x)})
  P.length <- aggregate(P$coli1 ~ P$ConcGr, FUN=length)
 
 rv <- data.frame(ConcGr=P.sd[,1],cv=P.cv[,2], length=P.length[,2])
 rv
}

FCstatistic(P)
```

## Define `FCrandom`

```{r}
# TODO(cp); make it work for n = 0
FCrandom <- function(P, n = 1){
  for (i in unique(P$Accession)){
    idx <- which(P$Accession == i)
    stopifnot(length(idx) >= n)
    smp <- sample(length(idx), n)
    P <- P[-idx[smp],]
  }
  P$n <- n
  P
}
```
  

## Conduct the random experiment


```{r}
set.seed(8)
S <- do.call('rbind', lapply(1:29, function(i){
  FCstatistic(FCrandom(P, i))
  }))

xyplot(cv ~ length|ConcGr, 
       data =S, 
       layout=c(4,1),
       strip = strip.custom(strip.names = TRUE, strip.levels = TRUE)
       )
```


```{r}
S.rep <- do.call('rbind', 
              lapply(1:n.simulation, function(s){
                set.seed(s); S <- do.call('rbind', lapply(1:29, function(i){FCstatistic(FCrandom(P, i))}))}))
```

## Camera ready plot of absolute flycode simulation

```{r NestLink_absolute_flycode_simulation, fig.retina=3, fig.height=6, fig.width=12, fig.path='Figs/'}
NestLink_absolute_flycode_simulation <- xyplot(cv ~ length/6 |  ConcGr,
       data = S.rep,
       panel = function(x,y,...){
         panel.abline(h=c(10, 50), col='red')
         panel.xyplot(x,y,...)
         xy.median <- (aggregate(y, by=list(x), FUN=median, na.rm = T))
         panel.points( xy.median[,1], xy.median[,2], pch=16)
         
         #panel.xyplot(x,y,...)
         #panel.loess(x,y)
       },
       xlab= 'Number of flycodes',
       ylab ='CV [%]',
       strip = strip.custom(strip.names = TRUE, strip.levels = TRUE),
       scales=list(y=list(at=c(0,10,50,100,150,200))),
       ylim=c(0,175),
       pch=16,
       col=rgb(0.5, 0.5, 0.5, alpha = 0.01),
       layout = c(4,1))

print(NestLink_absolute_flycode_simulation)

png("NestLink_absolute_flycode_simulation.png", 1200,800)
print(NestLink_absolute_flycode_simulation)
dev.off()
```


# Relative  Quantification

## Normalization

```{r}
P <- na.omit(P)
P <- P[P$coli1 >0,]


P$coli1 <- P$coli1 / sum(P$coli1)
P$coli2 <- P$coli2 / sum(P$coli2)
P$smeg1 <- P$smeg1 / sum(P$smeg1)
P$smeg2 <- P$smeg2 / sum(P$smeg2)
```

sanity check
```{r}
sum(P$coli1)
sum(P$coli2)
sum(P$smeg1)
sum(P$smeg2)
```
## Define ratios

```{r}
P$ratios <- (0.5* (P$coli1 + P$coli2)) / (0.5 * (P$smeg1 + P$smeg2))
```


```{r fig.retina=3}

b <- boxplot(P$coli1 / P$coli2, P$coli1 / P$smeg1, P$coli1 / P$smeg2,P$coli2 / P$smeg1, P$coli2 / P$smeg2 , P$smeg1 / P$smeg2, P$ratios, 
        ylab='ratios', ylim = c(0,2 ))
axis(1, 1:6, c('coli[12]', 'coli1-smeg1', 'coli1-smeg2', 'coli2-smeg1', 'coli2- smeg2','smeg[12]'))
```

```{r fig.retina=3}
op <- par(mfrow = c(1, 4))
boxplot(P$coli1 ~ P$ConcGr)
boxplot(P$coli2 ~ P$ConcGr)
boxplot(P$smeg1 ~ P$ConcGr)
boxplot(P$smeg2 ~ P$ConcGr)

```


## Determine outliers (removal)

```{r NestLink_boxplot_techrep_biorep, fig.retina=3, fig.height=12, fig.width=12, fig.path='Figs/'}

op <- par(mfrow=c(1,1), mar=c(5,5,5,2) )

b <- boxplot(df<-cbind(P$coli1/P$coli2, P$coli1/P$smeg1, P$coli1/P$smeg2, P$coli2/P$smeg1, P$coli2/P$smeg2, P$smeg1/P$smeg2, P$ratios),
             log='y',
        ylab='normalized ratios',
        #ylim = c(0, 2),
        axes=FALSE,
        main=paste("ConcGr = all"))
axis(1, 1:7, c('coli[12]', 'coli1-smeg1', 'coli1-smeg2', 'coli2-smeg1', 'coli2- smeg2','smeg[12]', 'ratio'))
abline(h=1, col='red')
box()
axis(2)
#axis(3, 1:7, b$n)
outliers.idx <- sapply(1:length(b$group),
    function(i){
      q <- df[, b$group[i]] == b$out[i];
      text(b$group[i], b$out[i], P[q, 2], pos=4, cex=0.4);
      text(b$group[i], b$out[i], P[q, 1], pos=2, cex=0.4);
      which(q)})
```

```{r}
b <- boxplot(df<-cbind(P$coli1/P$coli2, P$coli1/P$smeg1, P$coli1/P$smeg2, P$coli2/P$smeg1, P$coli2/P$smeg2, P$smeg1/P$smeg2, P$ratio),
             log='',
        ylab='normalized ratios',
        ylim = c(0, 2),
        axes=FALSE,
        main=paste("ConcGr = all"))
axis(1, 1:7, c('coli[12]', 'coli1-smeg1', 'coli1-smeg2', 'coli2-smeg1', 'coli2- smeg2','smeg[12]', 'ratio'))
abline(h=1, col='red')
box()
axis(2)
axis(3, 1:length(b$n), b$n)
outliers.idx <- sapply(1:length(b$group),
    function(i){
      q <- df[, b$group[i]] == b$out[i];
      text(b$group[i], b$out[i], P[q, 2], pos=4, cex=0.4);
      text(b$group[i], b$out[i], P[q, 1], pos=2, cex=0.4);
      which(q)})
```



```{r kable}
library(knitr)
kable(P[unique(outliers.idx),])

```

```{r fig.retina=3}
rv <-lapply(unique(P$ConcGr), function(q){
pairs((P[P$ConcGr == q ,c('coli1', 'coli2', 'smeg1', 'smeg2')]),
      pch=16, col=rgb(0.5,0.5,0.5,alpha = 0.3),
      lower.panel = panel.cor,
      asp=1,
      main=q)
})
```





```{r}
bwplot(ratios ~ Accession | ConcGr,
       data = P,
         strip = strip.custom(strip.names = TRUE, strip.levels = TRUE),
       panel = function(...){
         
         panel.abline(h=1, col='red')
         panel.bwplot(...)
       },
        ylim=c(-0,2),
       scales = list(x = list(relation = "free", rot=45)),
       layout = c(4,1))

bwplot(ratios ~ ConcGr,
       data = P,
       horizontal = FALSE,
       panel = function(...){
         
         panel.abline(h=1, col='red')
         panel.bwplot(...)
       },
       ylim=c(0,2),
       scales = list(x = list(relation = "free", rot=45)),
       layout = c(1,1))
```

```{r}

boxplot(ratios ~ ConcGr,data=P,ylim=c(0,2))
abline(h=1, col=rgb(1,0,0,alpha=0.4))
```

```{r}
P<-na.omit(P)
xyplot(ratios ~ Accession |  ConcGr,
       data = P,
         strip = strip.custom(strip.names = TRUE, strip.levels = TRUE),
       panel =function(x,y, ...){
         panel.abline(h=mean(y), col='red')
          panel.xyplot(x,y, pch=16, col=rgb(0.5,0.5,0.5,alpha = 0.5))
          xy.mean <- (aggregate(y, by=list(x), FUN=mean, na.rm = T))
           xy.sd <- (aggregate(y, by=list(x), FUN=sd, na.rm = T))
          panel.points( xy.mean[,1], xy.mean[,2])
          panel.points( xy.mean[,1], xy.mean[,2] + xy.sd[,2] , pch='-', col='red', cex=4)
           panel.points( xy.mean[,1], xy.mean[,2] - xy.sd[,2] , pch='-', col='red', cex=4)},
        ylim=c(0,2),
       scales = list(x = list(relation = "free", rot=45)),
       layout = c(4,1))
```

```{r}
P <- na.omit(P)
xyplot(ratios ~ Accession |  ConcGr,
       data = P,
       strip = strip.custom(strip.names = TRUE, strip.levels = TRUE),
       panel = function(x,y, ...){
         panel.abline(h=mean(y), col='red')
          panel.xyplot(x,y, pch=16, col=rgb(0.5,0.5,0.5,alpha = 0.5))
          xy.mean <- (aggregate(y, by=list(x), FUN=mean, na.rm = T))
           xy.sd <- (aggregate(y, by=list(x), FUN=sd, na.rm = T))
          panel.points( xy.mean[,1], xy.mean[,2])
          panel.points( xy.mean[,1], xy.mean[,2] + xy.sd[,2] , pch='-', col='red', cex=4)
           panel.points( xy.mean[,1], xy.mean[,2] - xy.sd[,2] , pch='-', col='red', cex=4)
           ltext(xy.mean[,1], (xy.mean[,2] + xy.sd[,2]) , round(xy.sd[,2],2), pos=3, cex=0.5)
           },
        
       layout = c(4,1),
       scales = list(y=list(log=TRUE),
                     x = list(relation = "free", rot=45)),
       )
```
## Detect outlier

```{r}
# P.cv <- aggregate(P$ratios ~ P$Accession, FUN=function(x){100*sd(x)/mean(x)})
```


```{r fig.retina=3, fig.cap="measured ratios were plotted; red represents the sd and blue points the mean."}
P<-na.omit(P)
trellis.par.set("strip.background",t)

xyplot(ratios ~ ConcGr | ConcGr,
       data = P,
         strip = strip.custom(strip.names = TRUE, strip.levels = TRUE),
       panel = function(x,y){
         panel.abline(h=1, col='red')
          panel.xyplot(x,y, pch=16, col=rgb(0.5,0.5,0.5,alpha = 0.5))
          panel.points(x, mean(y))
         #   panel.points(x, median(y),col='green')
          panel.points(x, mean(y) + sd(y), pch='-', col='red',cex=5)
          ltext(x, mean(y) + sd(y), round(sd(y),3), pos=4)
         
           panel.points(x, mean(y) - sd(y), pch='-', col='red',cex=5)
         },
        #ylim=c(-1,3),
       scales = list(x = list(relation = "free", rot=45)),
       layout = c(4,1))
```




```{r}
outlier.idx <- which(P$ratios > 2)
P[outlier.idx, ]

# We do not remove outliers.
# P <- P[-outlier.idx,]
```
```{r fig.retina=3, fig.cap="measured ratios were plotted; red represents the sd and blue points the mean."}
P<-na.omit(P)
trellis.par.set("strip.background",t)

xyplot(ratios ~ ConcGr | ConcGr,
       data = P,
         strip = strip.custom(strip.names = TRUE, strip.levels = TRUE),
       panel = function(x,y){
         panel.abline(h=1, col='red')
          panel.xyplot(x,y, pch=16, col=rgb(0.5,0.5,0.5,alpha = 0.5))
          panel.points(x, mean(y))
         #   panel.points(x, median(y),col='green')
          panel.points(x, mean(y) + sd(y), pch='-', col='red',cex=5)
          ltext(x, mean(y) + sd(y), round(sd(y),3), pos=4)
         
           panel.points(x, mean(y) - sd(y), pch='-', col='red',cex=5)
         },
        #ylim=c(-1,3),
       scales = list(x = list(relation = "free", rot=45)),
       layout = c(4,1))
```
## Define `FCstatistics`


to make the random experiment fair!
```{r}
P <- FCfill2max(P)
```


```{r}
FCstatistics <- function(P){
  if(!"ratios" %in% names(P)){
    P$ratios <- ((0.5 * (P$coli1 + P$coli2)) / (0.5 * (P$smeg1 + P$smeg2)))
    warning("define ratios.")
  }
  P.length <- aggregate(P$ratios ~ P$ConcGr, FUN=length)
  names(P.length) <- c('ConcGr', 'length')
  
  P <- na.omit(P)
  
  P.mean <- aggregate(P$ratios ~ P$ConcGr, FUN=mean)
  names(P.mean) <- c('ConcGr', 'mean')
  
  P.median <- aggregate(P$ratios ~ P$ConcGr, FUN=median)
  names(P.median) <- c('ConcGr', 'median')
  
  P.sd <- aggregate(P$ratios ~ P$ConcGr, FUN=sd)
  names(P.sd) <- c('ConcGr', 'sd')
  
 rv <- data.frame(ConcGr=P.mean$ConcGr,
                  mean=P.mean$mean,
                  sd=P.sd$sd, cv=100 * P.sd$sd / P.mean$mean,
                  length=P.length$length, 
                  median=P.median$median)
 rv
}
```
```{r}

FCstatistics2 <- function(P,i=NA, mode='bio'){
  
  P.sum.coli1 <- aggregate(P$coli1 ~ P$Accession + P$ConcGr, FUN=sum)
  P.sum.coli2 <- aggregate(P$coli2 ~ P$Accession + P$ConcGr, FUN=sum)
  P.sum.smeg1 <- aggregate(P$smeg1 ~ P$Accession + P$ConcGr, FUN=sum)
  P.sum.smeg2 <- aggregate(P$smeg2 ~ P$Accession + P$ConcGr, FUN=sum)
  
  PP <- P.sum.coli1
  
  names(PP) <- c('Accession', 'ConcGr', 'coli1')
  PP$coli2 <- P.sum.coli2$`P$coli2`
  PP$smeg1 <- P.sum.smeg1$`P$smeg1`
  PP$smeg2 <- P.sum.smeg2$`P$smeg2`
  
  P <- PP
  if(!"ratios" %in% names(P)){
    if (mode == 'tech_smeg'){
      P$ratios <- P$smeg1 / P$smeg2
    }
    else if(mode == 'tech_coli'){
      P$ratios <- P$coli1 / P$coli2
    }else{
      # bio
      P$ratios <- ((0.5 * (P$coli1 + P$coli2)) / (0.5 * (P$smeg1 + P$smeg2)))
    }
   
    #warning("define ratios.")
  }
  P.length <- aggregate(P$ratios ~ P$ConcGr, FUN=length)
  names(P.length) <- c('ConcGr', 'length')
  
  P <- na.omit(P)
  
  P.mean <- aggregate(P$ratios ~ P$ConcGr, FUN=mean)
  names(P.mean) <- c('ConcGr', 'mean')
  
  P.median <- aggregate(P$ratios ~ P$ConcGr, FUN=median)
  names(P.median) <- c('ConcGr', 'median')
  
  P.sd <- aggregate(P$ratios ~ P$ConcGr, FUN=sd)
  names(P.sd) <- c('ConcGr', 'sd')
  
 rv <- data.frame(ConcGr=P.mean$ConcGr,
                  mean=P.mean$mean,
                  sd=P.sd$sd, cv=100 * P.sd$sd / P.mean$mean,
                  length=P.length$length, 
                  median=P.median$median, i=rep(i,length(P.median$median)))
 rv
}
```


## Conduct the random experiment
```{r}
library(parallel)

set.seed(1)

P.replicate <- do.call('rbind',
                       mclapply(1:n.simulation, function(run){
                         do.call('rbind', lapply(1:29,
                                                 function(i) {
                                                   rv <- FCstatistics2(FCrandom(P, i), 29-i)
                                                   rv$run = run
                                                   rv
                                                 }))
                       }, mc.cores = 4))
```

```{r}
set.seed(1)

P.replicate.smeg <- do.call('rbind',
                       mclapply(1:n.simulation/2, function(run){
                         do.call('rbind', lapply(1:29,
                                                 function(i) {
                                                   rv <- FCstatistics2(FCrandom(P, i), 29-i, mode='tech_smeg')
                                                   rv$run = run
                                                   rv
                                                 }))
                       }, mc.cores = 4))

set.seed(1)

P.replicate.coli <- do.call('rbind',
                       mclapply(1:n.simulation/2, function(run){
                         do.call('rbind', lapply(1:29,
                                                 function(i) {
                                                   rv <- FCstatistics2(FCrandom(P, i), 29-i, mode='tech_coli')
                                                   rv$run = run
                                                   rv
                                                 }))
                       }, mc.cores = 4))

```

```{r fig.retina=3, fig.cap='the grey point cloud represents the means, sd, and cv of `n.simulation` conducted random experiments (removals) with a different number of FlyCodes.'}

xyplot(mean ~ i | ConcGr, 
       data=P.replicate,
       panel = function(...){
         panel.abline(h=1, col='red')
         panel.xyplot(...)
       },
         strip = strip.custom(strip.names = TRUE, strip.levels = TRUE),
       ylim=c(0,2),
       pch=16, col=rgb(0.5, 0.5, 0.5, alpha = 0.1),
       layout = c(4,1),
       xlab= 'number of FlyCodes',
       )

xyplot(sd ~ i | ConcGr, 
       data=P.replicate,
       panel = function(...){
         panel.xyplot(...)
       },
         strip = strip.custom(strip.names = TRUE, strip.levels = TRUE),
       pch=16, col=rgb(0.5, 0.5, 0.5, alpha = 0.1),
       layout = c(4,1),
       xlab= 'number of FlyCodes',
       )


xyplot(cv ~ i | ConcGr, 
       data=P.replicate,
       panel = function(...){
         panel.xyplot(...)
       },
       strip = strip.custom(strip.names = TRUE, strip.levels = TRUE),
       pch=16, col=rgb(0.5, 0.5, 0.5, alpha = 0.01),
       layout = c(4,1),
       xlab= 'number of FlyCodes',
       ylab ='cv [in %]'
       )
```


```{r}
FCstatistics2(P)
```

## Camera ready plot of relative flycode simulation
```{r NestLink_relative_flycode_simulation, fig.retina=3, fig.height=6, fig.width=12, fig.path='Figs/'}
SIM <- P.replicate
SIM$type <- "Biological replicates"
P.replicate.coli$type <- "Technical replicates"
P.replicate.smeg$type <- "Technical replicates"

NestLink_relative_flycode_simulation <- xyplot(cv ~ i | ConcGr * type, 
       index.cond=list(c(1,2,3,4), c(2,1)),
       data=do.call('rbind', list(SIM,P.replicate.coli,P.replicate.smeg)),
       panel = function(x,y,...){
         panel.abline(h=10, col='red')
         panel.xyplot(x, y,...)
         xy.median <- (aggregate(y, by=list(x), FUN=median, na.rm = T))
         panel.points( xy.median[,1], xy.median[,2], pch=16)
       },
       strip = strip.custom(strip.names = TRUE, strip.levels = TRUE),
       pch=16,
       col=rgb(0.5, 0.5, 0.5, alpha = 0.01),
       layout = c(4,2),
       ylim = c(0,50),
       xlab= 'Number of flycodes',
       ylab ='CV [%]'
       )
print(NestLink_relative_flycode_simulation)
#imgsize <- 1000 
#png("NestLink_relative_flycode_simulation.png", 1.5 * imgsize, imgsize, pointsize = 58)
#print(NestLink_relative_flycode_simulation)
#dev.off()
```


# Session info

Here is the output of `sessionInfo()` on the system on which this
document was compiled:

```{r sessionInfo, echo=FALSE}
sessionInfo()
```



